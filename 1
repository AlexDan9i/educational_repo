‚úÖ 1. –û—Ç–ø—Ä–∞–≤–∫–∞ Status Message –∏–∑ Task Sequence
–î–æ–±–∞–≤—å—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–π —à–∞–≥ PowerShell:

powershell
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
# –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ Status Message —Å ID 91001
$SCCMNamespace = "root\ccm"
$Instance = ([wmiclass]"\\.\$SCCMNamespace:SMS_Client").CreateStatusMessageInstance()
$Instance.SiteCode = "ABC"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Site Code
$Instance.Component = "TaskSequence"
$Instance.MessageID = 91001
$Instance.Severity = 1  # 1 = Informational, 2 = Warning, 3 = Error
$Instance.Properties = @("Hostname=$env:COMPUTERNAME")
$Instance.Insert()
üìå –í–∞–∂–Ω–æ: SiteCode ‚Äî —ç—Ç–æ –≤–∞—à ConfigMgr —Å–∞–π—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, PR1, ABC, MCM). –£–∑–Ω–∞—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å MECM.

‚úÖ 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Query –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
–í –∫–æ–Ω—Å–æ–ª–∏ MECM:

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Monitoring ‚Üí System Status ‚Üí Status Message Queries.

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é Query, –Ω–∞–ø—Ä–∏–º–µ—Ä:

Name: Computer Join Notification

Message ID: 91001

Component: TaskSequence

–î–æ–±–∞–≤—å—Ç–µ –∫–æ–ª–æ–Ω–∫—É Message Text, Computer, Time.

–¢–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ, –∫–∞–∫–∏–µ –ü–ö "–ø—Ä–æ—Å–∏–≥–Ω–∞–ª–∏–ª–∏" –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ TS.

‚úÖ 3. –°–µ—Ä–≤–µ—Ä-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (—Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è)
–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ AD –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞ PowerShell, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç MECM SQL-–±–∞–∑—É –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

powershell
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
# Config
$SiteDB = "CM_ABC"  # –ë–î —Å–∞–π—Ç–∞ MECM
$SQLServer = "mecm-sql01.domain.local"
$MessageID = 91001
$targetGroups = @("MyADGroup1", "MyADGroup2", "MyADGroup3")

# –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å AD
Import-Module ActiveDirectory

# SQL-–∑–∞–ø—Ä–æ—Å: –Ω–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã, –æ—Ç–ø—Ä–∞–≤–∏–≤—à–∏–µ —Å—Ç–∞—Ç—É—Å
$query = @"
SELECT DISTINCT sm.MachineName, sm.Time
FROM v_StatusMessage sm
JOIN v_StatMsgAttributes att ON sm.RecordID = att.RecordID
WHERE sm.MessageID = $MessageID
AND sm.Time >= DATEADD(hour, -1, GETDATE())
ORDER BY sm.Time DESC
"@

$conn = New-Object System.Data.SqlClient.SqlConnection
$conn.ConnectionString = "Server=$SQLServer;Database=$SiteDB;Integrated Security=True"
$conn.Open()

$cmd = $conn.CreateCommand()
$cmd.CommandText = $query
$reader = $cmd.ExecuteReader()

while ($reader.Read()) {
    $hostname = $reader["MachineName"]
    Write-Host "–û–±—Ä–∞–±–æ—Ç–∫–∞: $hostname" -ForegroundColor Yellow

    try {
        $comp = Get-ADComputer -Identity $hostname -ErrorAction Stop
        foreach ($group in $targetGroups) {
            if (-not (Get-ADGroupMember $group | Where-Object { $_.DistinguishedName -eq $comp.DistinguishedName })) {
                Add-ADGroupMember -Identity $group -Members $comp
                Write-Host "$hostname –¥–æ–±–∞–≤–ª–µ–Ω –≤ $group" -ForegroundColor Green
            }
        }
    } catch {
        Write-Warning "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ $hostname: $_"
    }
}

$reader.Close()
$conn.Close()
‚úÖ 4. –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–ó–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (—á–µ—Ä–µ–∑ Task Scheduler) –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç.

–ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ.

